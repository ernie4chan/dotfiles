# User and Group management

## Users 

- stored inside `/etc/passwd`

### useradd

Creates new user account with default settings

- `useradd [configurations] username`
- Example: 

    `useradd --shell /sbin/nologin --home-dir /usr/local/nginx nginx`
- nologin denies user shell access (used for accounts destined to be running a service)
- default adduser settings inside `/etc/adduser.conf`

### usermod

- allows later modification of user (e.g., password)
- e.g., give shell access: `usermod --shell /bin/bash nginx`

### userdel

- allows deleting user (-r switch will wipe his home directory)

## Groups

- stored in `/etc/group`
- allows users of a group to inherit all its access permissions on files and directories
- user account belongs to at least user's primary group

### addgroup

- adds up to two groups with given name
- add user to group `usermod --append --groups groupname username`

### delgroup

- removes group (remove all users from group first)

# Programs and processes

## System Services

- applications running in the background (can be started in background via `&` after command)
- scripts that manage service startup and shutdown placed in several dirs, most common `/etc/init.d`
- commands given to init scripts (but not always implemented) `start, stop, restart, reload, status`
- `service --status-all` lists all system services and their status
- `service <name> <command>` allows controlling (e.g., starting, stopping) services

## Process management

### Listing processes

- `ps aux` lists all currently running processes
- `top` shows all currently running processes sorted by CPU usage and refreshes every second

### Killing Processes

- `kill pid` e.g., `kill 111` sends kill signal to process (process may ignore it)
- `kill -9 pid` forces process to terminate
- `killall processname` kills all processes with given name

### Further Reading

- [Different ways of showing Unix processes](http://www.cyberciti.biz/faq/show-all-running-processes-in-linux/)
- [htop examples](http://www.thegeekstuff.com/2011/09/linux-htop-examples/)
- [Linux System Monitoring Tools](http://www.cyberciti.biz/tips/top-linux-monitoring-tools.html)
# Linux File System

## Directory structure

- **/bin and /sbin**    binaries and system binaries respectively
- **/boot**             files used during system boot
- **/dev**              Devices (e.g., cdrom)
- **/home**             home directories for all users except root
- **/lib**              libraries required by binaries in **bin** and **sbin**
- **/media**            acess removable media using mount points
- **/mnt**              temporarily mounted file systems
- **/opt**              optional software packages (rarely used)
- **/proc**             kernel and process information virtual filesystem (statistics and details about running processes)
- **/root**             root user home directory
- **/srv**              service data (rarely used)
- **/tmp**              temporary files not to be preserved beyond program execution
- **/usr**              mirrors root directory structure to provide secondare hierarchy for shareable read-only user data
- **/var**              files that are expected to be modified by running applications or services
    - **/lib**          state information related to apps or the OS (e.g., MySql database files)
    - **/lock**         files used for synchronized resource access between applications
    - **/log**          log files generated by programs, services or system kernel
    - **/mail**         shortcut to /var/spool/mail
    - **/run**          runtime data, provides info about state of the system since it started (cleared on reboot)
    - **/spool**        files to be processed (e.g., emails and print jobs)
    - **/tmp**          temporary files deleted on reboot

## Pseudo devices

- **/dev**
    - **/null**          Null device: writing is always successful, reading returns no data (use to redirect/hide output)
    - **/random**        stream of true rambom numbers (write to it to feed pool)
    - **/urandom**       stream of pseudo random numbers (write to it to feed pool)
    - **/full**          returns error when written to and reads infinite stream of null characters
    - **/zero**          always successful when written to and reads infinite stream of null characters
    
## Files and inodes

### EXT3 filesystem 

- has 16 terabytes/file and 32 terabytes/device restrictions 
- lays out data so that file fragmentation is kept to minimum, hence no defragmentation is needed
- filenames up to 256 characters are case sensitive

### Inodes

- index nodes store extra information about a file (e.g., file permissions, ownership, filesize, access/modification times)
- `ls -i` retrieves inode number
- timestamps (use `stat` to retrieve them)
    - atime: Access time (last time read)
    - mtime: Modification time (last time file content changed)
    - ctime: Change time (last time file content or inode data changed)

### Symbolic and hard links

#### Symbolic links

- `ln -s target link` 
- read and write access is performed on the target of the link
- `rm` performed on link doesn't affect target
- may connect via relative paths

#### Hard links

- `ln target link`
- represent actual connections to file data
- once last link to target is removed, target is removed as well
- if target is removed, link remains

## Compression and archiving

### tar

- extension represents .gathering.compression algorithm/method
- .tar.gz (Gzip) and .tar.bz2 (bzip2) favored since they are open source
- tar (Tape archive) concatenates multiple files into one tarball and optionally compresses it
- `tar czvf archive.tar.gz folder` creates Gzip tar file
- `tar cjvf archive.tar.bz2 folder` creates bzip2 tar file
- `tar xzvf archive.tar.gz` extracts Gzip tar file
- `tar xjvf archive.tar.gz` extracts bzip2 tar file

### rar and zip

- `unrar x file.rar`
- `unzip file.zip`

# System administration tools

## Superuser

- `su` logs in as root
- `sudo command` executes command with superuser account
- users allowed to gain root privileges are in `/etc/sudoers` (edit it via **visudo**)

## System verification and maintenance

### Disk and memory tools

- `df -h` Disk Free shows available storage on mounted devices
- `du -h` Disk Usage shows space occupied by each folder in given directory
- `free -m` displays current system memory usage, swap memory stats and buffers used by the system 

### Package management

Manually download and install debian package via:

    wget ftp://.../name.deb
    sudo dpkg -i name.deb

note, that this doesn't process dependencies

Build from source via (consult readme file after download):

    wget http://../name.tar.gz
    tar zxvf name.tar.gz
    cd name
    ./configure
    make
    sudo make install

## Files and permissions

### Files

- three access types (**r**ead, **w**rite, e**x**ecute)
- columns `drwx|rwx|rwx`
    - first character (-: file, d: directory, l: link)
    - first column: owner permissions
    - second column: group permissions
    - third column: other user's permissions

### Directories

- **x** specifies folder entry permission
- **r** specifies list folder content permission
- **w** specifies writing of new files in folder permission

### Octal representation

- three to four digits (no permissions 0..7 all permissions) map to permission columns (above)
- each digit has weight: (r=1, w=2, x=4), add them to get octal presentation
- use `chmod ugo` octal to reset permissions for everyone (e.g., `chmod 744` - owner=all, everyone else=x permissions)

### Changing permissions

- `chmod who+/-what filename`
    - who: combination of **u**ser/owner, **g**roup, **o**thers and **a**ll
    - +/-: grant/remove permissions
    - what: **r**ead, **w**rite and e**x**ecute
- `chmod go-rwx file` only owner has access to file
- `chmod a-w file` nobody can edit file
- `chmod -R g+rx folder` folder can be accessed by all users in the group (applied recursively)

### Changing ownership and group

- `chown user filename` changes file's owner
- `chgrp group filename` changes file's group
- `chown user:group filename` alternative syntax to change both owner and group
- commands accept `-R` switch

# System services

## Startup init

- System-V style init daemon uses `init` daemon to manage startup process
    - funcions on `runlevels` principle
        - 0: System is halted
        - 1: Single-user (rescue) mode
        - 2: Multiuser mode (without NFS support)
        - 3: Full multiuser mode
        - 4: Not used
        - 5: GUI mode
        - 6: System reboot
    - can be manually invoked via `telinit runlevel` (e.g., `telinit 6` to reboot)
    - set of services execute for each **runlevel transition**
    - on startup level goes from 0 to 2 (Debian and Ubuntu)
    - each runlevel has scripts folder associated with it (/etc/rc0.d ../etc/rc6.d) with links to scripts in `/etc/init.d`
- init script controls daemon application via **start** (invoked when computer
  starts), **stop** and can be manually executed via: `service name command` or `/etc/init.d/name command`
- enable init script for system runlevel (after adding it to /etc/inid.d/): `update-rc.d -f name defaults`
    - creates links in default runlevel folders
    - script will execute with **stop** for **reboot** and **shutdown** and with **start** for **all other runlevels**
    - sample script for [installing a virtual box as a service] (http://www.glump.net/howto/virtualbox_as_a_service)
- show and switch on/off enabled init scripts via `rcconf` tool

    
